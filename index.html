<!DOCTYPE html>
<html lang="zh-CN">





<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/brain.ico">
  <link rel="icon" type="image/png" href="/img/brain.ico">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="description" content>
  <meta name="author" content="Li Junhao">
  <meta name="keywords" content="Windows,Kernel,Qt,Security">
  <title>God mercy me</title>

  <link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<link rel="stylesheet" href="/lib/bootstrap/css/bootstrap.min.css">
<link rel="stylesheet" href="/lib/mdbootstrap/css/mdb.min.css">
<link rel="stylesheet" href="/lib/github-markdown/github-markdown.min.css">
<link rel="stylesheet" href="//at.alicdn.com/t/font_1067060_qzomjdt8bmp.css">


  <link rel="stylesheet" href="/lib/prettify/tomorrow-night-eighties.min.css">

<link rel="stylesheet" href="/css/main.css">


  <link rel="stylesheet" href="/lib/fancybox/jquery.fancybox.min.css">


</head>


<body>
  <header style="height: 100vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>God mercy me</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/">首页</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/archives/">归档</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/categories/">分类</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/tags/">标签</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/about/">关于</a>
          </li>
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="view intro-2" id="background"
         style="background: url('/img/homepage.jpg')no-repeat center center;
           background-size: cover;
           background-attachment: fixed;">
      <div class="full-bg-img">
        <div class="mask rgba-black-light flex-center">
          <div class="container text-center white-text fadeInUp">
            <span class="h2" id="subtitle">
              
            </span>

            
          </div>

          
            <div class="scroll-down-bar">
              <i class="fas fa-angle-down scroll-down-arrow"></i>
            </div>
          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      <div class="container nopadding-md">
        <div class="py-5 z-depth-3" id="board">
          
          <div class="container">
            <div class="row">
              <div class="col-12 col-md-10 m-auto">
                


  <div class="row mb-4 mx-auto">
    
    
      <div class="col-12 col-md-4 m-auto">
        <a href="/Security/InfinityHook/" target="_self">
          <img src="/img_post/etdiag2.png" srcset="/img/loading.gif" alt="InfinityHook" class="img-fluid rounded z-depth-3 index-thumbnails">
        </a>
      </div>
    
    <div class="col-12 col-md-8 m-auto">
      <a href="/Security/InfinityHook/">
        <p class="h4 index-header">InfinityHook</p>
        
        
          
        
        <div class="index-excerpt" >
          <div class="index-text mb-1">InfinityHook原理与实现0x00 前言本文所述的Hook技术非本人原创，偶然在git上看到某开源项目InfinityHook，拜读其源码后略微解读了InfinityHook的原理。
参考资料：    https://github.com/everdox/InfinityHook
​                       https://bbs.pediy.com/thread-253450.htm
0x01 介绍熟悉Hook技术的都应该知道，Hook技术一般是通过挂钩系统调用，上下文切换，页面错误，DPC等，对系统内核调用进行过滤/拦截/修改等操作。一般使用较多的Hook技术主要有SSDT Hook/InLine Hook/IDT Hook等。
Hook技术的确是一种很强大技术，在windows闭源的背景下可以让内核开发工程师进行更接近windows底层进行安全功能的开发。同样，有安全就有攻击，不少恶意代码也通过同样的技术来进行恶意攻击。为此自windows vista后微软为限制人为非法修改windows系统内核，引入了PG（PatchGuard）机制。当PG检测到系</div>
        </div>
      </a>

      <div>
        
          <i class="iconfont icon-riqi2"></i>&nbsp;2020-01-24&nbsp;&nbsp;
        
        
          <i class="iconfont icon-inbox"></i>
          
            <a href="/categories/Security">Security</a>&nbsp;
          &nbsp;
        
        
          <i class="iconfont icon-tag"></i>
          
            <a href="/tags/-Driver%20-Hook">-Driver -Hook</a>&nbsp;
          
        
      </div>
    </div>
  </div>

  <div class="row mb-4 mx-auto">
    
    
      <div class="col-12 col-md-4 m-auto">
        <a href="/MQTT/MQTT-开发基础/" target="_self">
          <img src="/img_post/MQTTDev.jpg" srcset="/img/loading.gif" alt="MQTT 开发基础" class="img-fluid rounded z-depth-3 index-thumbnails">
        </a>
      </div>
    
    <div class="col-12 col-md-8 m-auto">
      <a href="/MQTT/MQTT-开发基础/">
        <p class="h4 index-header">MQTT 开发基础</p>
        
        
          
        
        <div class="index-excerpt" >
          <div class="index-text mb-1">了解MQTT协议MQTT 是一种连接协议，它指定了如何组织数据字节并通过 TCP/IP 网络传输它们。但实际上，开发人员并不需要了解这个连接协议。我们只需要知道，每条消息有一个命令和数据有效负载。该命令定义消息类型（例如 CONNECT 消息或 SUBSCRIBE 消息）。所有 MQTT 库和工具都提供了直接处理这些消息的简单方法，并能自动填充一些必需的字段，比如消息和客户端 ID。

首先，客户端发送一条 CONNECT 消息来连接代理。CONNECT 消息要求建立从客户端到代理的连接。CONNECT 消息包含以下内容参数。



参数
说明



cleanSession
此标志指定连接是否是持久性的。持久会话会将所有订阅和可能丢失的消息（具体取决于 QoS） 都存储在代理中。


username
代理的身份验证和授权凭证。


password
代理的身份验证和授权凭证。


lastWillTopic
连接意外中断时，代理会自动向某个主题发送一条 “last will” 消息。


lastWillQos
“last will” 消息的 QoS。


lastWillMess</div>
        </div>
      </a>

      <div>
        
          <i class="iconfont icon-riqi2"></i>&nbsp;2019-12-05&nbsp;&nbsp;
        
        
          <i class="iconfont icon-inbox"></i>
          
            <a href="/categories/MQTT">MQTT</a>&nbsp;
          &nbsp;
        
        
          <i class="iconfont icon-tag"></i>
          
            <a href="/tags/MQTT">MQTT</a>&nbsp;
          
        
      </div>
    </div>
  </div>

  <div class="row mb-4 mx-auto">
    
    
      <div class="col-12 col-md-4 m-auto">
        <a href="/Network/MQTT-协议-3-1-1/" target="_self">
          <img src="/img_post/MQTT4.png" srcset="/img/loading.gif" alt="MQTT 协议 3.1.1" class="img-fluid rounded z-depth-3 index-thumbnails">
        </a>
      </div>
    
    <div class="col-12 col-md-8 m-auto">
      <a href="/Network/MQTT-协议-3-1-1/">
        <p class="h4 index-header">MQTT 协议 3.1.1</p>
        
        
          
        
        <div class="index-excerpt" >
          <div class="index-text mb-1">MQTT协议3.1.1中文版

OASIS标准 2014年10月29日

规范链接 (Specification URIs)当前版本(This version)：http://docs.oasis-open.org/mqtt/mqtt/v3.1.1/os/mqtt-v3.1.1-os.doc (Authoritative)
http://docs.oasis-open.org/mqtt/mqtt/v3.1.1/os/mqtt-v3.1.1-os.html
http://docs.oasis-open.org/mqtt/mqtt/v3.1.1/os/mqtt-v3.1.1-os.pdf
以前的版本(Previous version)：http://docs.oasis-open.org/mqtt/mqtt/v3.1.1/cos01/mqtt-v3.1.1-cos01.doc (Authoritative)
http://docs.oasis-open.org/mqtt/mqtt/v3.1.1/cos01/mqtt-v3.1.1-cos01.html
http://docs.oasis-o</div>
        </div>
      </a>

      <div>
        
          <i class="iconfont icon-riqi2"></i>&nbsp;2019-11-05&nbsp;&nbsp;
        
        
          <i class="iconfont icon-inbox"></i>
          
            <a href="/categories/Network">Network</a>&nbsp;
          &nbsp;
        
        
          <i class="iconfont icon-tag"></i>
          
            <a href="/tags/MQTT">MQTT</a>&nbsp;
          
        
      </div>
    </div>
  </div>

  <div class="row mb-4 mx-auto">
    
    
      <div class="col-12 col-md-4 m-auto">
        <a href="/Network/MQTT-协议-5-0/" target="_self">
          <img src="/img_post/MQTT5.0.png" srcset="/img/loading.gif" alt="MQTT 协议 5.0" class="img-fluid rounded z-depth-3 index-thumbnails">
        </a>
      </div>
    
    <div class="col-12 col-md-8 m-auto">
      <a href="/Network/MQTT-协议-5-0/">
        <p class="h4 index-header">MQTT 协议 5.0</p>
        
        
          
        
        <div class="index-excerpt" >
          <div class="index-text mb-1">MQTT 协议 5.0中文版
委员会规范草案 02 
公开评审草案 02
2017年10月26日
规范链接

当前版本:
http://docs.oasis-open.org/mqtt/mqtt/v5.0/csprd02/mqtt-v5.0-csprd02.docx (Authoritative)
http://docs.oasis-open.org/mqtt/mqtt/v5.0/csprd02/mqtt-v5.0-csprd02.html
http://docs.oasis-open.org/mqtt/mqtt/v5.0/csprd02/mqtt-v5.0-csprd02.pdf


以前的版本:
http://docs.oasis-open.org/mqtt/mqtt/v5.0/csprd01/mqtt-v5.0-csprd01.docx (Authoritative)
http://docs.oasis-open.org/mqtt/mqtt/v5.0/csprd01/mqtt-v5.0-csprd01.html
http://docs.oasis-open.org/mqtt/mq</div>
        </div>
      </a>

      <div>
        
          <i class="iconfont icon-riqi2"></i>&nbsp;2019-11-05&nbsp;&nbsp;
        
        
          <i class="iconfont icon-inbox"></i>
          
            <a href="/categories/Network">Network</a>&nbsp;
          &nbsp;
        
        
          <i class="iconfont icon-tag"></i>
          
            <a href="/tags/MQTT">MQTT</a>&nbsp;
          
        
      </div>
    </div>
  </div>

  <div class="row mb-4 mx-auto">
    
    
      <div class="col-12 col-md-4 m-auto">
        <a href="/设计模式/策略模式-Strategy-Pattern/" target="_self">
          <img src="/img_post/transfer_success.jpg" srcset="/img/loading.gif" alt="策略模式 Strategy Pattern" class="img-fluid rounded z-depth-3 index-thumbnails">
        </a>
      </div>
    
    <div class="col-12 col-md-8 m-auto">
      <a href="/设计模式/策略模式-Strategy-Pattern/">
        <p class="h4 index-header">策略模式 Strategy Pattern</p>
        
        
          
        
        <div class="index-excerpt" >
          <div class="index-text mb-1">简介在策略模式（Strategy Pattern）中，一个类的行为或其算法可以在运行时更改。这种类型的设计模式属于行为型模式。
在策略模式中，我们创建表示各种策略的对象和一个行为随着策略对象改变而改变的 context 对象。策略对象改变 context 对象的执行算法。
应用场景目前我在加密算法的使用上用到了这样的策略模式，可以动态选择加密的具体方法：MD5/SHA2/SM3等
实现方式这里按照我个人的理解方式，我会拿一个商场促销活动的例子。
商场促销，有2种可以选择的折扣方式：1.总价打八折；2.每满100元减22元。
首先可以建立一个策略的抽象类：
class Strategy
{
public:
    virtual void Calculation(double &amp;total) = 0;
    virtual ~Strategy(){}
};
然后继承于策略类写出具体的算法：
class ConcreteStrategyA : public Strategy   //总价打八折
{
public:
    void Calculation(double &amp;</div>
        </div>
      </a>

      <div>
        
          <i class="iconfont icon-riqi2"></i>&nbsp;2019-10-17&nbsp;&nbsp;
        
        
          <i class="iconfont icon-inbox"></i>
          
            <a href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F">设计模式</a>&nbsp;
          &nbsp;
        
        
          <i class="iconfont icon-tag"></i>
          
            <a href="/tags/C++">C++</a>&nbsp;
          
        
      </div>
    </div>
  </div>

  <div class="row mb-4 mx-auto">
    
    
      <div class="col-12 col-md-4 m-auto">
        <a href="/设计模式/单例模式-Singleton-Pattem/" target="_self">
          <img src="/img_post/transfer_success.jpg" srcset="/img/loading.gif" alt="单例模式 Singleton Pattem" class="img-fluid rounded z-depth-3 index-thumbnails">
        </a>
      </div>
    
    <div class="col-12 col-md-8 m-auto">
      <a href="/设计模式/单例模式-Singleton-Pattem/">
        <p class="h4 index-header">单例模式 Singleton Pattem</p>
        
        
          
        
        <div class="index-excerpt" >
          <div class="index-text mb-1">简介在面向对象设计与开发中，往往会碰到一些特殊的情况，必须保证一个类在系统中只存在一个实例，这样才能确保它们的逻辑正确性。
因此就产生了这种特殊的设计模式：单例模式。
特点
单例类只有一个实例。
单例类必须自己创建自己的唯一实例。
单例类必须给所有其他对象提供这一实例。

应用场景
Windows的Task Manager（任务管理器）就是很典型的单例模式，你不能同时打开两个任务管理器。Windows的回收站也是同理。
应用程序的日志应用，一般都可以用单例模式实现，只能有一个实例去操作文件。
读取配置文件，读取的配置项是公有的，一个地方读取了所有地方都能用，没有必要所有的地方都能读取一遍配置。
数据库连接池，多线程的线程池。

懒汉模式懒汉模式：单例类的静态局部变量只在第一次调用的时候被初始化一次，时间换空间，线程不安全
class Singleton
{
public:

    static Singleton&amp; GetInstance()
    {
        static Singleton instance;
        return instance;
 </div>
        </div>
      </a>

      <div>
        
          <i class="iconfont icon-riqi2"></i>&nbsp;2019-10-16&nbsp;&nbsp;
        
        
          <i class="iconfont icon-inbox"></i>
          
            <a href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F">设计模式</a>&nbsp;
          &nbsp;
        
        
          <i class="iconfont icon-tag"></i>
          
            <a href="/tags/C++">C++</a>&nbsp;
          
        
      </div>
    </div>
  </div>

  <div class="row mb-4 mx-auto">
    
    
      <div class="col-12 col-md-4 m-auto">
        <a href="/Security/ClamAV开源杀毒引擎二次开发0x01/" target="_self">
          <img src="/img_post/logan.jpg" srcset="/img/loading.gif" alt="ClamAV 开源杀毒引擎二次开发 0x01" class="img-fluid rounded z-depth-3 index-thumbnails">
        </a>
      </div>
    
    <div class="col-12 col-md-8 m-auto">
      <a href="/Security/ClamAV开源杀毒引擎二次开发0x01/">
        <p class="h4 index-header">ClamAV 开源杀毒引擎二次开发 0x01</p>
        
        
          
        
        <div class="index-excerpt" >
          <div class="index-text mb-1">0x00 前言从本文开始我会记录下研究ClamAV开源反病毒引擎的过程，会对整个源码的编译/使用/注释按个人理解做一些说明。学习过程必然是由浅入深的，可能有时前面文章中自己的看法并不正确，之后也会按自己的理解深入来修改之前的文章。
0x01 环境准备
ClamAV防病毒引擎编译环境：VS2017  Professional


二次开发环境：QT5.12.4 MSVC 2017 32/64bit


引擎源码下载：clamav-0.101.4 （哪边下都行）


github仓库：https://github.com/Cisco-Talos/clamav-devel
git clone https://github.com/vrtadmin/clamav-devel.git



官网地址：https://www.clamav.net/downloads


OpenSSL库

0x02 目录结构首先我们要进入win32目录，找到VS工程配置文件打开，可以看到clamav 工程目录下有很多项目，目前我们只需要着重关注 libclamav ，这就是整个防病毒引擎库项目，官方介绍 The </div>
        </div>
      </a>

      <div>
        
          <i class="iconfont icon-riqi2"></i>&nbsp;2019-09-28&nbsp;&nbsp;
        
        
          <i class="iconfont icon-inbox"></i>
          
            <a href="/categories/Security">Security</a>&nbsp;
          &nbsp;
        
        
          <i class="iconfont icon-tag"></i>
          
            <a href="/tags/ClamAV">ClamAV</a>&nbsp;
          
        
      </div>
    </div>
  </div>

  <div class="row mb-4 mx-auto">
    
    
      <div class="col-12 col-md-4 m-auto">
        <a href="/Security/ClamAV开源杀毒引擎二次开发0x00/" target="_self">
          <img src="/img_post/the_last_jedi.png" srcset="/img/loading.gif" alt="ClamAV 开源杀毒引擎二次开发 0x00" class="img-fluid rounded z-depth-3 index-thumbnails">
        </a>
      </div>
    
    <div class="col-12 col-md-8 m-auto">
      <a href="/Security/ClamAV开源杀毒引擎二次开发0x00/">
        <p class="h4 index-header">ClamAV 开源杀毒引擎二次开发 0x00</p>
        
        
          
        
        <div class="index-excerpt" >
          <div class="index-text mb-1">前言近来有想法研究下windows下的杀毒引擎，一来是为了之后的工作中大概率会接触一些，二来也是因为自己兴趣所向。接下来发布的“基于ClamAV开源杀毒引擎二次开发”文章都是为研究该开源杀毒引擎编译/调用/工作方式所做的笔记，其中所述的方式方法不一定正确，若有错误理解也请指正。
首先为什么选择ClamAV这款杀毒引擎来学习呢？因为我就只找到了这么一个开源的，能在windows上用的…
然后我看了官网上使用手册中的介绍，功能还是相当强大的，不逊于一般的杀毒引擎。
ClamAV®  Introduction/简介ClamAV® is an open source antivirus engine for detecting trojans, viruses, malware &amp; other malicious threats.
ClamAV® is an open source (GPL) anti-virus engine used in a variety of situations including email scanning, web scanning, and end</div>
        </div>
      </a>

      <div>
        
          <i class="iconfont icon-riqi2"></i>&nbsp;2019-09-28&nbsp;&nbsp;
        
        
          <i class="iconfont icon-inbox"></i>
          
            <a href="/categories/Security">Security</a>&nbsp;
          &nbsp;
        
        
          <i class="iconfont icon-tag"></i>
          
            <a href="/tags/ClamAV">ClamAV</a>&nbsp;
          
        
      </div>
    </div>
  </div>





              </div>
            </div>
          </div>
        </div>
      </div>
    
  </main>

  
    <a class="z-depth-1" id="scroll-top-button" href="#" role="button">
      <i class="fa fa-chevron-up scroll-top-arrow" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  <footer class="mt-5">
  <div class="text-center py-3">
    <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><b>Hexo</b></a>
    <i class="iconfont icon-love"></i>
    <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"> <b>Fluid</b></a>
    <br>

    
  
    <!-- 不蒜子统计PV -->
    
    &nbsp;<span id="busuanzi_container_site_pv">总访问量 
          <span id="busuanzi_value_site_pv"></span> 次</span>&nbsp;
  
  
    <!-- 不蒜子统计UV -->
    
    &nbsp;<span id="busuanzi_container_site_uv">总访客数 
            <span id="busuanzi_value_site_uv"></span> 人</span>&nbsp;
  
  <br>



    


    <!-- cnzz Analytics icon -->
    

  </div>
</footer>

<!-- SCRIPTS -->
<script src="/lib/jquery/jquery.min.js" ></script>
<script src="/lib/popper/popper.min.js" ></script>
<script src="/lib/bootstrap/js/bootstrap.min.js" ></script>
<script src="/lib/mdbootstrap/js/mdb.min.js" ></script>
<script src="/js/main.js" ></script>


  <script src="/js/lazyload.js" ></script>





  <script src="/lib/smooth-scroll/smooth-scroll.min.js" ></script>



  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>


<!-- Plugins -->


  

  

  

  

  <!-- cnzz Analytics -->
  



  <script src="/lib/prettify/prettify.min.js" ></script>
  <script>
    $(document).ready(function () {
      $('pre').addClass('prettyprint  linenums');
      prettyPrint();
    })
  </script>



  <script src="/lib/typed/typed.min.js" ></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "Live in dark / Serve in light&nbsp;",
      ],
      cursorChar: "_",
      typeSpeed: 70,
      loop: false,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script src="/lib/anchor/anchor.min.js" ></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "false",
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script src="/js/local-search.js" ></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      getSearchFile(path);
      this.onclick = null
    }
  </script>



  <script src="/lib/fancybox/jquery.fancybox.min.js" ></script>
  <script>
    $("#post img:not(.no-zoom img, img[no-zoom])").each(
      function () {
        var element = document.createElement("a");
        $(element).attr("data-fancybox", "images");
        $(element).attr("href", $(this).attr("src"));
        $(this).wrap(element);
      }
    );
  </script>











</body>
</html>
